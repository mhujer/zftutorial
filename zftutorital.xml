<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbook.rng" type="xml"?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"
    version="5.0" xml:lang="cs">
    <info>
        <title>Začínáme se Zend Frameworkem 1.10</title>
        <author>
            <personname>Rob Allen (autor)</personname>
        </author>
        <author>
            <personname>Martin Hujer (překlad)</personname>
            <email>mhujer@gmail.com</email>
        </author>
    </info>
    <para><emphasis role="italic">Tento text je překladem anglického návodu <link
                xlink:href="http://akrabat.com/zend-framework-tutorial/">Tutorial: Getting Started
                with Zend Framework 1.10</link>, jehož autorem je Rob Allen (revize
            1.7.6)</emphasis>
    </para>
    <para>Učelem tutoriálu je představení použití Zend Frameworku vytvořením jednoduché databázové
        aplikace s využitím vzoru Model-View-Controller.</para>
    <para>
        <emphasis role="bold">Poznámka: Tento tutoriál byl testován na Zend Frameworku od verze
            1.10.1 do 1.11.4. Je velká šance, že bude fungovat s následujícími verzemi řady 1.x, ale
            nebude fungovat s verzemi předcházejícími 1.10.1.</emphasis>
    </para>
    <section>
        <title>Požadavky</title>
        <para>Zend Framework má tyto požadavky:<itemizedlist>
                <listitem>
                    <para>PHP 5.2.4 (nebo vyšší)</para>
                </listitem>
                <listitem>
                    <para>Webový server s podporou <code>mod_rewrite</code> nebo podobnou
                        funkcionalitou</para>
                </listitem>
            </itemizedlist></para>
    </section>
    <section>
        <title>Předpoklady</title>
        <para>Předpokládám, že používáte webový server Apache a PHP 5.2.4 nebo vyšší. <emphasis
                role="bold">Je nutné, aby jste měli v Apachi nainstalované a nastavené rozšíření
                mod_rewrite</emphasis></para>
        <para>Je také nutné se ujistit, že Apache má nastavenou podporu souboru
                <filename>.htaccess</filename>. To se obvykle dělá pomocí změny:
            <programlisting language="apache"><![CDATA[AllowOverride None]]></programlisting> na
            <programlisting language="apache"><![CDATA[AllowOverride All]]></programlisting> v
            souboru <filename>httpd.conf</filename>. Podrobnější informace zjistíte v dokumentaci k
            Apache. Pokud nebude mít správně nastavený <code>mod_rewrite</code> a
                <filename>.htaccess</filename>, tak nebude moci otevřít jinou stránku než homepage.
        </para>
    </section>
    <section>
        <title>Získání frameworku</title>
        <para>Zend Framework je k dispozici ke stažení na adrese <link
                xlink:href=" http://framework.zend.com/download/latest"
                >http://framework.zend.com/download/latest</link> buď v .zip nebo .tar.gz formátu.
            Na konci stránky naleznete přímé odkazy. Verze "Minimal" je to, co potřebujete. </para>
    </section>
    <section>
        <title>Nastavení Zend_Tool</title>
        <para> Zend Framework je dodávan s nástrojem pro příkazovou řádku. Začneme tedy jeho
            nastavením. </para>
        <section>
            <title>Zend_Tool na Windows</title>
            <para>
                <itemizedlist>
                    <listitem>
                        <para>Vytvořte nový adresář v <code>Program Files</code> pojmenovaný
                                <filename>ZendFrameworkCli</filename></para>
                    </listitem>
                    <listitem>
                        <para>Poklikejte na stažený soubor,
                                <filename>ZendFramework-1.10.6-minimal.zip.</filename></para>
                    </listitem>
                    <listitem>
                        <para>Zkopírujte adresáře <code>bin</code> a <code>library</code> do složky
                                <filename>C:\Program Files\ZendFrameworkCli</filename>. Složka teď
                            bude mít dva podadresáře <filename>bin</filename> a
                                <filename>library</filename>.</para>
                    </listitem>
                    <listitem>
                        <para>Přidejte adresář <code>bin</code> do systémové cesty:</para>
                        <para>
                            <itemizedlist>
                                <listitem>
                                    <para>Ovládací panely -> Systém</para>
                                </listitem>
                                <listitem>
                                    <para>Upřesnit nastavení systému -> karta Upřesnit -> Proměnné
                                        prostředí</para>
                                </listitem>
                                <listitem>
                                    <para>V části "Systémové proměnné" najděte <code>Path</code> a
                                        poklikejte na ni</para>
                                </listitem>
                                <listitem>
                                    <para>Přidejte <code>;C:\Program
                                            Files\ZendFrameworkCli\bin</code> na konec pole a
                                        stiskněte OK. (Středník na začátku je důležitý!)</para>
                                </listitem>
                                <listitem>
                                    <para>Restartuje PC. (Pozn. možná to půjde i bez toho)</para>
                                </listitem>
                            </itemizedlist>
                        </para>
                    </listitem>
                </itemizedlist>
            </para>
        </section>
        <section>
            <title>Zend_Tool na OS X (na Linuxu je to stejné)</title>
            <para>
                <itemizedlist>
                    <listitem>
                        <para>Rozbalte stažený soubor
                                <filename>ZendFramework-1.10.6-minimal.zip.</filename> ve vaší
                            složce <filename>Downloads</filename> poklikáním na něj.</para>
                    </listitem>
                    <listitem>
                        <para>Zkopírujte do <filename>/usr/local/ZendFrameworkCli</filename> -
                            otevřete Terminal a napište:</para>
                        <para>
                            <code>sudo cp -r ~/Downloads/ZendFramework-1.10.6-minimal
                                /usr/local/ZendFrameworkCli</code>
                        </para>
                    </listitem>
                    <listitem>
                        <para>Přidejte si alias do svého bash profilu: <itemizedlist>
                                <listitem>
                                    <para>Do Terminalu zadejte <code>open
                                        ~/.bash_profile</code></para>
                                </listitem>
                                <listitem>
                                    <para>Na konec souboru přidejte <code>alias
                                            zf=/usr/local/ZendFrameworkCli/bin/zf.sh</code></para>
                                </listitem>
                                <listitem>
                                    <para>Uložte a zavřete TextEdit</para>
                                </listitem>
                                <listitem>
                                    <para>Zavřete Terminal</para>
                                </listitem>
                            </itemizedlist>
                        </para>
                    </listitem>
                </itemizedlist>
            </para>
        </section>
        <section>
            <title>Otestování Zend_Tool</title>
            <para>To, že jste Zend_Tool správně nainstalovali ověříte tak, že otevřete příkazovou
                řádku a zadáte: <programlisting><![CDATA[zf show version]]></programlisting></para>
            <para>Pokud je vše v pořádku, uvidíte:
                <programlisting><![CDATA[Zend Framework Version: 1.10.0]]></programlisting></para>
            <para>Pokud ne, ověřte, zda jste správně nastavili cestu a že adresář
                    <filename>bin</filename> v <filename>ZendFrameworkCli</filename>
                existuje.</para>
            <para>
                <emphasis role="bold">Pokud je vaše distribuce PHP dodávána se Zend Frameworkem,
                    ověřte, zda nepoužívá verzi ZF 1.9, jinak vám tento tutoriál nebude
                    fungovat.</emphasis>
            </para>
        </section>
    </section>
    <section>
        <title>Vlastní aplikace</title>
        <para>Teď už je vše připraveno a můžeme se pustit do vytváření Zend Frameworkové aplikace.
            Nejprve se podíváme, co vlastně budeme dělat. Vytvoříme jednoduchý systém pro evidenci
            našich CDček. Hlavní stránka nám umožní přidat, upravovat a mazat CDčka. Při vývoji
            software je vždy dobré trochu plánovat. Náš web se bude skládat ze čtyř stránek:</para>
        <para>
            <informaltable frame="all">
                <tgroup cols="2">
                    <colspec colname="c1" colnum="1" colwidth="1.0*"/>
                    <colspec colname="c2" colnum="2" colwidth="3.0*"/>
                    <tbody>
                        <row>
                            <entry>Domovská stránka</entry>
                            <entry>Ta zobrazí seznam alb a odkazy na jejich editaci a smazání. Bude
                                tam také odkaz na přidání nového alba.</entry>
                        </row>
                        <row>
                            <entry>Přidat nové album</entry>
                            <entry>Tato stránka bude obsahovat formulář pro přidání nového
                                alba</entry>
                        </row>
                        <row>
                            <entry>Upravit album</entry>
                            <entry>Tato stránka bude obsahovat formulář pro editaci alba</entry>
                        </row>
                        <row>
                            <entry>Smazat album</entry>
                            <entry>Tato stránka nejdříve zobrazí potvrzení, zda opravdu chceme album
                                smazat a pak ho smaže.</entry>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable>
        </para>
        <para> Data budeme ukládat do databáze, kde budeme potřebovat jen jednu tabulku: </para>
        <para><informaltable frame="all">
                <tgroup cols="4">
                    <colspec colname="c1" colnum="1" colwidth="1.5*"/>
                    <colspec colname="c2" colnum="2" colwidth="1.5*"/>
                    <colspec colname="c3" colnum="3" colwidth="1.0*"/>
                    <colspec colname="c4" colnum="4" colwidth="2.5*"/>
                    <thead>
                        <row>
                            <entry>Jméno sloupce</entry>
                            <entry>Typ</entry>
                            <entry>Null?</entry>
                            <entry>Poznámky</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>id</entry>
                            <entry><code>integer</code></entry>
                            <entry>No</entry>
                            <entry>Primary key, auto increment</entry>
                        </row>
                        <row>
                            <entry>artist</entry>
                            <entry><code>varchar(100)</code></entry>
                            <entry>No</entry>
                            <entry/>
                        </row>
                        <row>
                            <entry>title</entry>
                            <entry><code>varchar(100)</code></entry>
                            <entry>No</entry>
                            <entry/>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable></para>
    </section>
    <section>
        <title>Začínáme vytvářet aplikaci</title>
        <para>Abychom si ušetřili práci a čas, budeme co nejvíce používat nástroj
                <filename>zf</filename>. První úkol je vytvoření kostry souborů a adresářů.</para>
        <para>Otevřte Terminal nebo příkazovou řádku a přepněte se do kořenového adresáře webového
            serveru. Například pro xampp to bude <filename>C:/xampp/htdocs/</filename>. Ujistěte se,
            že tam máte oprávnění pro zápis a webovým server může číst. Zadejte:</para>
        <para><code>zf create project zf-tutorial</code></para>
        <para>ZF vytvoří adresář <filename>zf-tutorial</filename> a v něm doporučenou strukturu. Ta
            předpokládá, že máte úplnou kontrolu nad nastavením Apache a proto umístí většinu
            souborů mimo root webu. Měli by jste vidět tyto soubory a adresáře:</para>
        <para><inlinemediaobject>
                <imageobject>
                    <imagedata fileref="img/directory-structure.png"/>
                </imageobject>
            </inlinemediaobject></para>
        <para>V adresáři <filename>public</filename> je ještě skrytý soubor
                <filename>.htaccess</filename></para>
        <para>Aplikace je uložena v adresáři <filename>application</filename>. Jak je vidět na
            obrázku, máme samostatné adresáře pro soubory modelu, view a controllerů. Adresář
                <filename>public/</filename> je adresář přístupný z webu, takže URL naší aplikace
            bude <uri>http://localhost/zf-tutorial/public/</uri>. Díky tomu není většina aplikace
            přístupná z webu a je tudíž bezpečnější.</para>
        <note>
            <para>Poznámka: Na živém serveru by jste vytvořili virtual host a nastavili document
                root přímo do adresáře <filename>public</filename>. Například pokud by jste
                vytvářeli virtual host pojmenovaný <code>zf-tutorial.localhost</code>, tak by to
                vypadalo nějak takto:</para>
            <para><programlisting language="apache"><![CDATA[<VirtualHost *:80>
    ServerName zf-tutorial.localhost
    DocumentRoot /var/www/html/zf-tutorial/public
    <Directory "/var/www/html/zf-tutorial/public">
        AllowOverride All
    </Directory>
</VirtualHost>]]></programlisting></para>
            <para>Web potom bude přístupný přes <uri> http://zf-tutorial.localhost/</uri>. Ujistěte
                se, že jste v souboru <filename>/etc/hosts</filename> nebo
                    <filename>c:\windows\system32\drivers\etc\hosts</filename> nasměrovali
                    <uri>zf-tutorial.localhost</uri> na 127.0.0.1. V tomto tutoriálu to tak dělat
                nebudeme, pro testování použijeme jen podadresář.</para>
        </note>
        <para>Obrázky, JavaScript a CSS soubory jsou uloženy v samostatných podadresářích v adresáři
                <filename>public/</filename>. Stažený Zend Framework umístíme do adresáře
                <filename>library/</filename>. Pokud budeme potřebovat další knihovny, tak ty patří
            také tam.</para>
        <para>Zkopírujte adresář <filename>library/Zend/</filename> ze staženého archivu
                <filename>ZendFramework-1.10.6-minimal.zip</filename> do vytvořeného
                <filename>zf-tutorial/library</filename>. Adresář
                <filename>zf-tutorial/library/</filename> bude tedy obsahovat adresář
                <filename>Zend</filename>.</para>
        <para>To, že je vše v pořádku můžete ověřit otevřením adresy
                <uri>http://localhost/zf-tutorial/public</uri>. Měli by jste vidět něco jako
            tohle:</para>
        <para><inlinemediaobject>
                <imageobject>
                    <imagedata fileref="img/basic-app-homepage.png"/>
                </imageobject>
            </inlinemediaobject></para>
        <section>
            <title>Princip bootstrapování</title>
            <para>Zend Framework využívá návrhový vzor Front Controller, kdy se všechy požadavky
                zpracovávají v jednom souboru <filename>index.php</filename>. Toho dosáhneme
                využitím souboru <filename>.htaccess</filename> v adresáři
                    <filename>zf-tutorial/public</filename>, který pro nás vytvořil
                    <code>Zend_Tool</code>. Ten přesměrová všechny požadavky na
                    <filename>public/index.php</filename>, který nám také vytvořil
                    <code>Zend_Tool</code>.</para>
            <para>Soubor <filename>index.php</filename> tvoří vstupní bod do naší aplikace a jeho
                úkolem je inicializace aplikace vytvořením instance <code>Zend_Application</code> a
                nastavení konstant <code>APPLICATION_PATH</code> a <code>APPLICATION_ENV</code>,
                který definují cestu do adresáře <filename>application/</filename> a prostředí
                (neboli mód) aplikace. Výchozím prostředím je <code>production</code> a je vhodné ho
                změnit na <code>development</code> přidání řádku do souboru
                    <filename>.htaccess</filename>:</para>
            <programlisting language="php">SetEnv APPLICATION_ENV development</programlisting>
            <para>Komponenta <code>Zend_Application</code> je použita ke spuštění aplikace a je
                nastavena pomocí konfiguračního souboru
                    <filename>application/configs/application.ini</filename>, který nám byl také
                předgenerován. Bootstrapovací třída, která dědí od <code>
                    Zend_Application_Bootstrap_Bootstrap</code> je k dispozici v
                    <filename>application/Bootstrap.php</filename> a může být použita pro specifický
                kód inicializující naši aplikaci.</para>
            <para>Soubor <filename>application.ini</filename>, který je uložen v adresáři
                    <filename>application/configs</filename> je načítán pomocí
                    <code>Zend_Config_Ini</code>. Ten umí interpretovat dědičnost sekcí, kterou
                uvedeme pomocí dvojtečky. Například: </para>
            <programlisting language="ini">[staging : production]</programlisting>
            <para>To znamená, že sekce <code>staging</code> dědí nastavení sekce
                    <code>production</code>. Konstanta <code>APPLICATION_ENV</code> určuje, která
                sekce se načte. Při vývoji chceme používat sekci <code>development</code> a na živém
                serveru <code>production</code>. Všechny změny v <code>application.ini</code> budeme
                vkládat do sekce <code>production</code>. Tím docílíme toho,že všechny varianty
                konfigurace budou obsahovat to, co jsme přidali.</para>
        </section>
        <section>
            <title>Úpravy souboru application.ini</title>
            <para>První změna kterou musíme udělat je nastavení naší časové zóny, aby správně
                fungovaly PHPčkové funkce pro práci s datem a časem. Upravíme
                    <filename>application/configs/application.ini</filename> a přidáme:</para>
            <programlisting language="ini">phpSettings.date.timezone = "Europe/Prague"</programlisting>
            <para>pod všechny hodnoty <code>phpSettings</code> v sekci <code>[production]</code>.
                Samozřejmě volbu můžeme upravit podle své časové zóny. Teď už jsme připraveni začít
                přidávat kód specifický pro naši aplikaci.</para>
        </section>
    </section>
    <section>
        <title>Kód naší aplikace</title>
        <para>Předtím než začneme nastavovat naše soubory, je nutné pochopit, jak je aplikace v Zend
            Frameworku strukturovaná. Každá stránka aplikace je označována jako <emphasis
                role="bold">akce</emphasis> [en: action] a ty jsou seskupeny v <emphasis role="bold"
                >kontrolerech</emphasis> [en: controller]. Pro URL ve formátu
                <uri>http://localhost/zf-tutorial/public/news/view</uri> je kontroler
                <code>News</code> a akce <code>view</code>. To umožňuje seskupování souvisejících
            akcí. Například kontroler <code>News</code> může mít akce <code>list</code>,
                <code>archived</code>, <code>view</code>. MVC systém Zend Frameworku podporuje také
            moduly, které slouží k seskupování kontrolerů. Tato aplikace nebude tak veliká, abychom
            se s nimi museli zabývat.</para>
        <para>V základním nastavení si Zend Framework rezervuje akci <code>index</code> jako
            výchozí. To je pro případy jako je <uri>http://localhost/zf-tutorial/public/news/</uri>,
            kdy není akce zadána. Zavolá se tedy výchozí akce <code>index</code>. Existuje také
            výchozí jméno kontroleru, <code>index</code>, a proto
                <uri>http://localhost/zf-tutorial/public/</uri> zavolá akci <code>index</code> z
                <code>Index</code> kontroleru.</para>
        <para>Protože jsme v jednoduchém tutoriálu, tak se nebudeme zabývat <quote>složitými</quote>
            věcmi jako je přihlašování apod. To může počkat do samostatného návodu (a nebo si o tom
            můžete přečíst v <emphasis role="italics">Zend Framework in Action</emphasis>!).</para>
        <para>Máme čtyři stránky, které se vztahují k albům a ty seskupíme do jednoho kontoleru jako
            čtyři akce. Použijeme výchozí kontoler [<code>Index</code>] a akce v něm budou:</para>
        <para>
            <table frame="all">
                <title/>
                <tgroup cols="3">
                    <colspec colname="c1" colnum="1" colwidth="1.0*"/>
                    <colspec colname="newCol2" colnum="2"/>
                    <colspec colname="c2" colnum="3" colwidth="1.0*"/>
                    <thead>
                        <row>
                            <entry>Stránka</entry>
                            <entry>Kontroler</entry>
                            <entry>Akce</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>Domácí stránka</entry>
                            <entry><code>Index</code></entry>
                            <entry><code>index</code></entry>
                        </row>
                        <row>
                            <entry>Přidat nové album</entry>
                            <entry><code>Index</code></entry>
                            <entry><code>add</code></entry>
                        </row>
                        <row>
                            <entry>Editovat album </entry>
                            <entry><code>Index</code></entry>
                            <entry><code>edit</code></entry>
                        </row>
                        <row>
                            <entry>Smazat album</entry>
                            <entry><code>Index</code></entry>
                            <entry><code>delete</code></entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </para>
        <para>Až budeme mít složitější web, budeme potřebovat více kontrolerů a pokud to bude
            potřeba, tak můžeme použít i moduly pro seskupování kontrolerů.</para>
    </section>
    <section>
        <title>Vytvoření kontroleru</title>
        <para>Třída kontroleru v Zend Frameworku musí být pojmenována <code>{jméno
                kontroleru}Controller</code>. Všimněte si že <code>{jméno kontroleru}</code> musí
            začínat velkým písmenem. Tato třída musí být uložena v souboru <filename>{jméno
                Kontroleru}Controller.php</filename> v adresáři
                <filename>application/controllers</filename>. Každá akce je <code>public</code>
            funkce ve třídě kontroleru a musí být pojmenována <code>{jméno akce}Action</code>. V
            tomto případě začíná <code>{jméno akce}</code> malým písmenem a i zbytek musí být malými
            písmeny. Názvy kontrolerů a akcí se střídajícími se velkými a malými písmeny jsou
            povoleny, ale mají svoje pravidla, které je potřeba pochopit dříve, než je začnete
            používat. Podívejte se do dokumentace!</para>
        <para>Třída našeho kontroleru <code>IndexController</code> je uložena v souboru
                <filename>application/controllers/ IndexController.php</filename>, který nám
            automaticky vygeneroval Zend_Tool. Obsahuje také první akci, <code>indexAction()</code>,
            takže musíme přidat jen ty zbývající.</para>
        <para>Další akce se do kontroleru přidávají pomocí nástroje <application>zf</application> a
            příkazu <command>create action</command>. Otevřeme Terminál nebo příkazovou řádku,
            přejdeme do našeho adresáře <filename>zf-tutorial/</filename> a zadáme tyto tři příkazy: </para>
        <programlisting>zf create action add Index
zf create action edit Index
zf create action delete Index</programlisting>
        <para>Těmito příkazy jsme v <code>IndexController</code>u vytvořili tři nové metody:
                <code>addAction</code>, <code>editAction</code> a <code>deleteAction</code>. Také se
            nám vygenerovaly příslušné view scripty, které budeme potřebovat později. Teď už máme
            všechny čtyři akce, které chceme používat.</para>
        <para>Jejich URL jsou:</para>
        <para>
            <table frame="all">
                <title/>
                <tgroup cols="2">
                    <colspec colname="c1" colnum="1" colwidth="1.0*"/>
                    <colspec colname="c2" colnum="2" colwidth="1.0*"/>
                    <thead>
                        <row>
                            <entry>URL</entry>
                            <entry>Metoda akce</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>http://localhost/zf-tutorial/public/</entry>
                            <entry>IndexController::indexAction()</entry>
                        </row>
                        <row>
                            <entry>http://localhost/zf-tutorial/public/index/add</entry>
                            <entry>IndexController::addAction()</entry>
                        </row>
                        <row>
                            <entry>http://localhost/zf-tutorial/public/index/edit</entry>
                            <entry>IndexController::editAction()</entry>
                        </row>
                        <row>
                            <entry>http://localhost/zf-tutorial/public/index/delete</entry>
                            <entry>IndexController::deleteAction()</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </para>
        <para>Teď si můžete otestovat tři nové akce a měli by jste vidět zprávu jako je tato:</para>
        <para><emphasis role="italics">View script for controller <emphasis role="bold"
                    >index</emphasis> and script/action name <emphasis role="bold"
                >add</emphasis></emphasis>
        </para>
        <warning>
            <para>Pokud uvidíme Chybu 404, tak buď nemáte v Apachi povolený modul
                    <code>mod_rewrite</code> nebo mátě špatně nastavený <code>AllowOverride</code> v
                konfiguraci Apache a proto se nezpracová soubor <filename>.htaccess</filename> ve
                složce <filename>public/</filename>.</para>
        </warning>
    </section>
    <section>
        <title>Databáze</title>
        <para>Teď když už máme připravenou kostru aplikace s kontrolerem, akcemi a view scripty, je
            čas se podívat na datový model naší aplikace. Připomeňme, že model je ta část, která se
            stará o hlavní úkol aplikace (někdy také nazývané <quote>business rules</quote>. V našem
            případě se stará o databázi. Použijeme třídu <classname>Zend_Db_Table</classname>, která
            nám bude hledat, vkládat a mazat řádky z databázové tabulky.</para>
        <section>
            <title>Nastavení databáze</title>
            <para> Abychom mohli použít <classname>Zend_Db_Table</classname>, musíme nastavit, která
                databáze se má použít a s jakým uživatelským jménem a heslem se má přistupovat.
                Protože to nechceme dát natvrdo do aplikace, uložíme údaje do konfiguračního
                souboru. Komponenta <classname>Zend_Application</classname> má resource pro
                připojení k databázi, takže všechno co musíme udělat je nastavit příslušné údaje v
                souboru <filename>configs/application.ini</filename> a ona se postará o
                zbytek.</para>
            <para>Otevřeme <filename>configs/application.ini</filename> a přidáme následující řádky
                na konec sekce <code>[production]</code> (t.j. nad sekci
                <code>[staging]</code>):</para>
            <programlisting language="ini">resources.db.adapter = PDO_MYSQL
resources.db.params.host = localhost
resources.db.params.username = rob
resources.db.params.password = 123456
resources.db.params.dbname = zf-tutorial</programlisting>
            <para>Samozřejmě by jste měli použít svoje uživatelské jméno, heslo a název databáze, ne
                moje! Teď se nám bude databázové spojení vytvářet automaticky a nastaví se jako
                výchozí adaptér <classname>Zend_Db_Table</classname>. O dalším dostupných resource
                pluginech si můžete přečíst zde:
                http://framework.zend.com/manual/en/zend.application.available-resources.html</para>
        </section>
        <section>
            <title>Vytvoření databázové tabulky</title>
            <para>Jak jsme říkali na začátku, bude pro ukládání dat o albech používat databázi.
                Použijeme MySQL, takže příkaz pro vytvoření tabulky je:</para>
            <programlisting language="sql">CREATE TABLE albums (
  id int(11) NOT NULL auto_increment,
  artist varchar(100) NOT NULL,
  title varchar(100) NOT NULL,
  PRIMARY KEY (id)
);</programlisting>
            <para>Spusťte ho v nějakém MySQL klientovi, třeba phpMyAdmin nebo přes standardního
                řádkového MySQL klienta.</para>
        </section>
        <section>
            <title>Vložení testovacích dat</title>
            <para>Také bychom do tabulky měli vložit nějaké řádky, abychom mohli otestovat, jestli
                nám hlavní stránka správně načítá data. Použijeme prvních pár
                    <quote>Nejprodávanějších</quote> CD z britského Amazonu. Ve svém MySQL klientovi
                spusťte:</para>
            <programlisting language="sql"><![CDATA[INSERT INTO albums (artist, title) VALUES
    ('Paolo Nutine', 'Sunny Side Up'),
    ('Florence + The Machine', 'Lungs'),
    ('Massive Attack', 'Heligoland'),
    ('Andre Rieu', 'Forever Vienna'),
    ('Sade', 'Soldier of Love');]]>
            </programlisting>
            <para>Teď už máme v naší databázi nějaká data a můžeme pro ni napsat velmi jednoduchý
                model.</para>
        </section>
    </section>
    <section>
        <title>Model</title>
        <para>V Zend Frameworku není třída <classname>Zend_Model</classname>, protože model je vaše
            business logika a rozhodnutí jak s ní pracovat je na vás. Existuje mnoho komponent,
            které můžete použít podle toho, co potřebujete. Jeden přístup je použití tříd modelu,
            které každá reprezentuje jednu entitu ve vaší aplikaci, a využít mapovací objekty, které
            načítají a ukládají entity do databáze. Tento přístup je popsán v Zend Framework
            QuickStart na adrese <link
                xlink:href="http://framework.zend.com/manual/en/learning.quickstart.create-model.html"
                >http://framework.zend.com/manual/en/learning.quickstart.create-model.html</link>.</para>
        <para>V tomto tutoriálu vytvoříme model, která dědí od <classname>Zend_Db_Table</classname>
            a používá <classname>Zend_Db_Table_Row</classname>. Třída
                <classname>Zend_Db_Table</classname>, implementuje návrhový vzor Table Data Gateway,
            který umožňuje objektově pracovat s daty v databázové tabulce. Mějte na paměti, že vzor
            Table Data Gateway může být ve větších systémech limitující.</para>
        <para>Z abstraktní třídy <classname>Zend_Db_Table_Abstract</classname> budeme dědit naše
            třídu, které je specifická pro správu alb. Je jedno, jak naši třídu pojmenujeme, ale
            dává smysl ji pojmenovat jako databázovou tabulku. Náš projekt má výchozí autoloader
            inicitalizovaný <classname>Zend_Application</classname>. Ten mapuje třídy v modulu na
            adresář, kde jsou uloženy. Pro složky <filename>application/</filename> používáme prefix
                <classname>Applcation_</classname>.</para>
        <para>Autoloader mapuje třídy na adresáře takto:<table frame="all">
                <title/>
                <tgroup cols="2">
                    <colspec colname="c1" colnum="1" colwidth="1.0*"/>
                    <colspec colname="c2" colnum="2" colwidth="1.0*"/>
                    <thead>
                        <row>
                            <entry>Prefix</entry>
                            <entry>Adresář</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry><classname>Form</classname></entry>
                            <entry><filename>forms</filename></entry>
                        </row>
                        <row>
                            <entry><classname>Model</classname></entry>
                            <entry><filename>models</filename></entry>
                        </row>
                        <row>
                            <entry><classname>Model_DbTable</classname></entry>
                            <entry><filename>models/DbTable</filename></entry>
                        </row>
                        <row>
                            <entry><classname>Model_Mapper</classname></entry>
                            <entry><filename>models/mappers</filename></entry>
                        </row>
                        <row>
                            <entry><classname>Plugin</classname></entry>
                            <entry><filename>plugins</filename></entry>
                        </row>
                        <row>
                            <entry><classname>Service</classname></entry>
                            <entry><filename>services</filename></entry>
                        </row>
                        <row>
                            <entry><classname>View_Filter</classname></entry>
                            <entry><filename>views/filters</filename></entry>
                        </row>
                        <row>
                            <entry><classname>View_Helper</classname></entry>
                            <entry><filename>views/helpers</filename></entry>
                        </row>
                    </tbody>
                </tgroup>
            </table></para>
        <para>Protože budeme pro pojmenování používat název tabulky, <code>albums</code>, a protože
            použijeme <classname>Zend_Db_Table</classname>, bude se naše třída jmenovat
                <classname>Application_Model_DbTable_Albums</classname> a bude uložena v adresáři
                <filename>applications/models/DbTable/Albums.php</filename></para>
        <para>Aby <classname>Zend_Db_Table</classname> věděla, kterou tabulku má spravovat, musíme
            nastavit protected atribut <varname>$_name</varname> na jméno tabulky.
                <classname>Zend_Db_Table</classname> dále předpokládá, že tabulka má primární klíč
                <code>id</code>, který je automaticky zvyšován na straně databáze. Jeho jméno může
            být v případě potřeby také změněno.</para>
        <para>Abychom si ušetřili práci, můžeme použít <command>zf</command> z příkazové řádky.
            Zadáme následující příkaz:</para>
        <programlisting><![CDATA[zf create db-table Albums albums]]></programlisting>
        <para>Nástroj nám vytvoři soubor <filename>Albums.php</filename> ve složce
                <filename>application/models/DbTable</filename>. V tomto souboru je třída
            pojmenovaná <classname>Application_Model_DbTable_Albums</classname>, která obsahuje
            nastavené jméno databázové tabulky, se kterou tato třída pracuje.</para>
        <para>Potřebujeme přidat ještě nějakou funkcionalitu, takže upravíme
                <filename>application/models/DbTable/Albums.php</filename> a přidáme metody
                <code>getAlbum()</code>, <code>addAlbum()</code>, <code>updateAlbum()</code> a
                <code>deleteAlbum()</code>, takže teď to vypadá takhle: </para>
        <programlisting language="php"><![CDATA[<?php
class Application_Model_DbTable_Albums extends Zend_Db_Table_Abstract
{
    protected $_name = 'albums';

    public function getAlbum($id)
    {
        $id = (int)$id;
        $row = $this->fetchRow('id = ' . $id);
        if (!$row) {
            throw new Exception("Could not find row $id");
        }
        return $row->toArray();
    }

    public function addAlbum($artist, $title)
    {
        $data = array(
            'artist' => $artist,
            'title' => $title,
        );
        $this->insert($data);
    }

    public function updateAlbum($id, $artist, $title)
    {
        $data = array(
            'artist' => $artist,
            'title' => $title,
        );
        $this->update($data, 'id = '. (int)$id);
    }

    public function deleteAlbum($id)
    {
        $this->delete('id =' . (int)$id);
    }
}]]></programlisting>
        <para>Vytořili jsme čtyři pomocné metody, které naše aplikace použije jako rozhraní pro
            přístup k databázi. <code>getAlbum()</code> načte jeden řádek jako pole,
                <code>addAlbum()</code> vytvoří nový řádek v databázi, <code>updateAlbum()</code>
            aktualizuje řádek alba v databázi a <code>deleteAlbum()</code> ho smaže. Kód každé z
            těchto metod je samovysvětlující. I když to v tomto tutoriálu není potřeba, můžete také
            říct <classname>Zend_Db_Table</classname> o souvisejících tabulkách a ta tak může
            načítat data i z nich. Teď potřebujeme v kontrolech získat data z modelu a zobrazit je
            pomocí view skriptů. Nicméně, nejdříve je potřeba pochopit, jak v Zend_Frameworku
            funguje šablonovací systém.</para>
    </section>
    <section>
        <title>Layout a viewčka</title>
        <para>View komponenta Zend Frameworku se podle očekávání jmenuje
                <classname>Zend_View</classname>. Umožňuje nám oddělit kód pro zobrazení stránky od
            aplikačního kódu.</para>
        <para>Základní použití <classname>Zend_View</classname> je:</para>
        <programlisting language="php"><![CDATA[$view = new Zend_View();
$view->setScriptPath('/path/to/scripts');
echo $view->render('script.php');]]></programlisting>
        <para>Na první pohled je vidět, že je zbytečné opakovat takovýdle nudný kód v každé akci.
            Raději si view zinicializujeme někde jinde a pak jen budeme již inicializovaný objekt
            používat v jednitlivých akcích. Zend Framework obsahuje Action Helper
                <classname>ViewRenderer</classname>. Ten za nás udělá inicializaci proměnné
            $this->view v kontroleru a také nám po skončení akce vykreslí view skript</para>

        <para><classname>ViewRenderer</classname> nastaví instanci <classname>Zend_View</classname>
            tak, aby view skripty hledala ve složce
                <filename>views/scripts/{jméno-kontroleru}</filename> a ve výchozím nastavení
            vyrenderovala view skript, který se jmenuje stejně jako akce, ale s příponou .phtml.
            Použije se tedy view script v souboru
                <filename>views/scripts/{jméno-kontroleru}/{jméno-akce}.phtml</filename> a
            vyrenderovaný výsledek se uloží do vlastnosti <varname>body</varname> objektu
                <classname>Response</classname>. Objekt <classname>Response</classname> se používá
            pro shromáždění všech HTTP hlaviček, obsahu a výjimek vygenerovaných z MVC. Front
            kontroler pak na konci zpracování odešle hlavičky a obsah
            <varname>body</varname>.</para>

        <para>Tohle všechno je pro nás vygenerováno, pokud použijeme
                <classname>Zend_Tool</classname> pro vytvoření projektu a pro přidávání kontrolerů a
            akcí pomocí příkazů <command>zf create controller</command> a <command>zf create
                action</command>.</para>

        <section>
            <title>Společný HTML kód: Layouty</title>
            <para/>
        </section>
    </section>
</article>
