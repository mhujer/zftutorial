<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbook.rng" type="xml"?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"
    version="5.0" xml:lang="cs">
    <info>
        <title>Začínáme se Zend Frameworkem 1.10</title>
        <author>
            <personname>Rob Allen (autor)</personname>
        </author>
        <author>
            <personname>Martin Hujer (překlad)</personname>
            <email>mhujer@gmail.com</email>
        </author>
    </info>
    <para>
        <emphasis role="italic">Tento text je překladem anglického návodu <link
                xlink:href="http://akrabat.com/zend-framework-tutorial/">Tutorial: Getting Started
                with Zend Framework 1.10</link>, jehož autorem je Rob Allen</emphasis>
    </para>
    <para>Učelem tutoriálu je představení použití Zend Frameworku vytvořením jednoduché databázové
        aplikace s využitím vzoru Model-View-Controller.</para>
    <para>
        <emphasis role="bold">Poznámka: Tento tutoriál byl testován na Zend Framework verze 1.10.3.
            Je velká šance, že bude fungovat s následujícími verzemi řady 1.x, ale nebude fungovat s
            verzemi předcházejícími 1.10.</emphasis>
    </para>
    <section>
        <title>Požadavky</title>
        <para>Zend Framework má tyto požadavky:<itemizedlist>
                <listitem>
                    <para>PHP 5.2.4 (nebo vyšší)</para>
                </listitem>
                <listitem>
                    <para>Webový server s podporou <code>mod_rewrite</code> nebo podobnou
                        funkcionalitou</para>
                </listitem>
            </itemizedlist></para>
    </section>
    <section>
        <title>Předpoklady</title>
        <para>Předpokládám, že používáte webový server Apache a PHP 5.2.4 nebo vyšší. <emphasis
                role="bold">Je nutné, aby jste měli v Apachi nainstalované a nastavené rozšíření
                mod_rewrite</emphasis></para>
        <para>Je také nutné se ujistit, že Apache má nastavenou podporu souboru
                <filename>.htaccess</filename>. To se obvykle dělá pomocí změny:
            <programlisting language="apache"><![CDATA[AllowOverride None]]></programlisting> na
            <programlisting language="apache"><![CDATA[AllowOverride All]]></programlisting> v
            souboru <filename>httpd.conf</filename>. Podrobnější informace zjistíte v dokumentaci k
            Apache. Pokud nebude mít správně nastavený <code>mod_rewrite</code> a
                <filename>.htaccess</filename>, tak nebude moci otevřít jinou stránku než homepage.
        </para>
    </section>
    <section>
        <title>Získání frameworku</title>
        <para>Zend Framework je k dispozici ke stažení na adrese <link
                xlink:href=" http://framework.zend.com/download/latest"
                >http://framework.zend.com/download/latest</link> buď v .zip nebo .tar.gz formátu.
            Na konci stránky naleznete přímé odkazy. Verze "Minimal" je to, co potřebujete. </para>
    </section>
    <section>
        <title>Nastavení Zend_Tool</title>
        <para> Zend Framework je dodávan s nástrojem pro příkazovou řádku. Začneme tedy jeho
            nastavením. </para>
        <section>
            <title>Zend_Tool na Windows</title>
            <para>
                <itemizedlist>
                    <listitem>
                        <para>Vytvořte nový adresář v <code>Program Files</code> pojmenovaný
                                <filename>ZendFrameworkCli</filename></para>
                    </listitem>
                    <listitem>
                        <para>Poklikejte na stažený soubor,
                                <filename>ZendFramework-1.10.6-minimal.zip.</filename></para>
                    </listitem>
                    <listitem>
                        <para>Zkopírujte adresáře <code>bin</code> a <code>library</code> do složky
                                <filename>C:\Program Files\ZendFrameworkCli</filename>. Složka teď
                            bude mít dva podadresáře <filename>bin</filename> a
                                <filename>library</filename>.</para>
                    </listitem>
                    <listitem>
                        <para>Přidejte adresář <code>bin</code> do systémové cesty:</para>
                        <para>
                            <itemizedlist>
                                <listitem>
                                    <para>Ovládací panely -> Systém</para>
                                </listitem>
                                <listitem>
                                    <para>Upřesnit nastavení systému -> karta Upřesnit -> Proměnné
                                        prostředí</para>
                                </listitem>
                                <listitem>
                                    <para>V části "Systémové proměnné" najděte <code>Path</code> a
                                        poklikejte na ni</para>
                                </listitem>
                                <listitem>
                                    <para>Přidejte <code>;C:\Program
                                            Files\ZendFrameworkCli\bin</code> na konec pole a
                                        stiskněte OK. (Středník na začátku je důležitý!)</para>
                                </listitem>
                                <listitem>
                                    <para>Restartuje PC. (Pozn. možná to půjde i bez toho)</para>
                                </listitem>
                            </itemizedlist>
                        </para>
                    </listitem>
                </itemizedlist>
            </para>
        </section>
        <section>
            <title>Zend_Tool na OS X (na Linuxu je to stejné)</title>
            <para>
                <itemizedlist>
                    <listitem>
                        <para>Rozbalte stažený soubor
                                <filename>ZendFramework-1.10.6-minimal.zip.</filename> ve vaší
                            složce <filename>Downloads</filename> poklikáním na něj.</para>
                    </listitem>
                    <listitem>
                        <para>Zkopírujte do <filename>/usr/local/ZendFrameworkCli</filename> -
                            otevřete Terminal a napište:</para>
                        <para>
                            <code>sudo cp -r ~/Downloads/ZendFramework-1.10.6-minimal
                                /usr/local/ZendFrameworkCli</code>
                        </para>
                    </listitem>
                    <listitem>
                        <para>Přidejte si alias do svého bash profilu: <itemizedlist>
                                <listitem>
                                    <para>Do Terminalu zadejte <code>open
                                        ~/.bash_profile</code></para>
                                </listitem>
                                <listitem>
                                    <para>Na konec souboru přidejte <code>alias
                                            zf=/usr/local/ZendFrameworkCli/bin/zf.sh</code></para>
                                </listitem>
                                <listitem>
                                    <para>Uložte a zavřete TextEdit</para>
                                </listitem>
                                <listitem>
                                    <para>Zavřete Terminal</para>
                                </listitem>
                            </itemizedlist>
                        </para>
                    </listitem>
                </itemizedlist>
            </para>
        </section>
        <section>
            <title>Otestování Zend_Tool</title>
            <para>To, že jste Zend_Tool správně nainstalovali ověříte tak, že otevřete příkazovou
                řádku a zadáte: <programlisting><![CDATA[zf show version]]></programlisting></para>
            <para>Pokud je vše v pořádku, uvidíte:
                <programlisting><![CDATA[Zend Framework Version: 1.10.0]]></programlisting></para>
            <para>Pokud ne, ověřte, zda jste správně nastavili cestu a že adresář
                    <filename>bin</filename> v <filename>ZendFrameworkCli</filename>
                existuje.</para>
            <para>
                <emphasis role="bold">Pokud je vaše distribuce PHP dodávána se Zend Frameworkem,
                    ověřte, zda nepoužívá verzi ZF 1.9, jinak vám tento tutoriál nebude
                    fungovat.</emphasis>
            </para>
        </section>
    </section>
    <section>
        <title>Vlastní aplikace</title>
        <para>Teď už je vše připraveno a můžeme se pustit do vytváření Zend Frameworkové aplikace.
            Nejprve se podíváme, co vlastně budeme dělat. Vytvoříme jednoduchý systém pro evidenci
            našich CDček. Hlavní stránka nám umožní přidat, upravovat a mazat CDčka. Při vývoji
            software je vždy dobré trochu plánovat. Náš web se bude skládat ze čtyř stránek:</para>
        <para>
            <informaltable frame="all">
                <tgroup cols="2">
                    <colspec colname="c1" colnum="1" colwidth="1.0*"/>
                    <colspec colname="c2" colnum="2" colwidth="3.0*"/>
                    <tbody>
                        <row>
                            <entry>Domovská stránka</entry>
                            <entry>Ta zobrazí seznam alb a odkazy na jejich editaci a smazání. Bude
                                tam také odkaz na přidání nového alba.</entry>
                        </row>
                        <row>
                            <entry>Přidat nové album</entry>
                            <entry>Tato stránka bude obsahovat formulář pro přidání nového
                                alba</entry>
                        </row>
                        <row>
                            <entry>Upravit album</entry>
                            <entry>Tato stránka bude obsahovat formulář pro editaci alba</entry>
                        </row>
                        <row>
                            <entry>Smazat album</entry>
                            <entry>Tato stránka nejdříve zobrazí potvrzení, zda opravdu chceme album
                                smazat a pak ho smaže.</entry>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable>
        </para>
        <para> Data budeme ukládat do databáze, kde budeme potřebovat jen jednu tabulku: </para>
        <para><informaltable frame="all">
                <tgroup cols="4">
                    <colspec colname="c1" colnum="1" colwidth="1.5*"/>
                    <colspec colname="c2" colnum="2" colwidth="1.5*"/>
                    <colspec colname="c3" colnum="3" colwidth="1.0*"/>
                    <colspec colname="c4" colnum="4" colwidth="2.5*"/>
                    <thead>
                        <row>
                            <entry>Jméno sloupce</entry>
                            <entry>Typ</entry>
                            <entry>Null?</entry>
                            <entry>Poznámky</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>id</entry>
                            <entry><code>integer</code></entry>
                            <entry>No</entry>
                            <entry>Primary key, auto increment</entry>
                        </row>
                        <row>
                            <entry>artist</entry>
                            <entry><code>varchar(100)</code></entry>
                            <entry>No</entry>
                            <entry/>
                        </row>
                        <row>
                            <entry>title</entry>
                            <entry><code>varchar(100)</code></entry>
                            <entry>No</entry>
                            <entry/>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable></para>
    </section>
    <section>
        <title>Začínáme vytvářet aplikaci</title>
        <para>Abychom si ušetřili práci a čas, budeme co nejvíce používat nástroj
                <filename>zf</filename>. První úkol je vytvoření kostry souborů a adresářů.</para>
        <para>Otevřte Terminal nebo příkazovou řádku a přepněte se do kořenového adresáře webového
            serveru. Například pro xampp to bude <filename>C:/xampp/htdocs/</filename>. Ujistěte se,
            že tam máte oprávnění pro zápis a webovým server může číst. Zadejte:</para>
        <para><code>zf create project zf-tutorial</code></para>
        <para>ZF vytvoří adresář <filename>zf-tutorial</filename> a v něm doporučenou strukturu. Ta
            předpokládá, že máte úplnou kontrolu nad nastavením Apache a proto umístí většinu
            souborů mimo root webu. Měli by jste vidět tyto soubory a adresáře:</para>
        <para><inlinemediaobject>
                <imageobject>
                    <imagedata fileref="img/directory-structure.png"/>
                </imageobject>
            </inlinemediaobject></para>
        <para>V adresáři <filename>public</filename> je ještě skrytý soubor
                <filename>.htaccess</filename></para>
        <para>Aplikace je uložena v adresáři <filename>application</filename>. Jak je vidět na
            obrázku, máme samostatné adresáře pro soubory modelu, view a controllerů. Adresář
                <filename>public/</filename> je adresář přístupný z webu, takže URL naší aplikace
            bude <uri>http://localhost/zf-tutorial/public/</uri>. Díky tomu není většina aplikace
            přístupná z webu a je tudíž bezpečnější.</para>
        <note>
            <para>Poznámka: Na živém serveru by jste vytvořili virtual host a nastavili document
                root přímo do adresáře <filename>public</filename>. Například pokud by jste
                vytvářeli virtual host pojmenovaný zf-tutorial.localhost, tak by to vypadalo nějak
                takto:</para>
            <para><programlisting language="apache"><![CDATA[<VirtualHost *:80>
    ServerName zf-tutorial.localhost
    DocumentRoot /var/www/html/zf-tutorial/public
    <Directory "/var/www/html/zf-tutorial/public">
        AllowOverride All
    </Directory>
    </VirtualHost>]]></programlisting></para>
            <para>Web potom bude přístupný přes <uri> http://zf-tutorial.localhost/</uri>. Ujistěte
                se, že jste v souboru <filename>/etc/hosts</filename> nebo
                    <filename>c:\windows\system32\drivers\etc\hosts</filename> nasměrovali
                    <uri>zf-tutorial.localhost</uri> na 127.0.0.1. V tomto tutoriálu to tak dělat
                nebudeme, pro testování použijeme jen podadresář.</para>
        </note>
        <para>Obrázky, JavaScript a CSS soubory jsou uloženy v samostatných podadresářích v adresáři
                <filename>public/</filename>. Stažený Zend Framework umístíme do adresáře
                <filename>library/</filename>. Pokud budeme potřebovat další knihovny, tak ty patří
            také tam.</para>
        <para>Zkopírujte adresář <filename>library/Zend/</filename> ze staženého archivu
                <filename>ZendFramework-1.10.6-minimal.zip</filename> do vytvořeného
                <filename>zf-tutorial/library</filename>. Adresář
                <filename>zf-tutorial/library/</filename> bude tedy obsahovat adresář
                <filename>Zend</filename>.</para>
        <para>To, že je vše v pořádku můžete ověřit otevřením adresy
                <uri>http://localhost/zf-tutorial/public</uri>. Měli by jste vidět něco jako
            tohle:</para>
        <para><inlinemediaobject>
                <imageobject>
                    <imagedata fileref="img/basic-app-homepage.png"/>
                </imageobject>
            </inlinemediaobject></para>
        <section>
            <title>Princip bootstrapování</title>
            <para>Zend Framework využívá návrhový vzor Front Controller, kdy se všechy požadavky
                zpracovávají v jednom souboru <filename>index.php</filename>. Toho dosáhneme
                využitím souboru <filename>.htaccess</filename> v adresáři
                    <filename>zf-tutorial/public</filename>, který pro nás vytvořil
                    <code>Zend_Tool</code>. Ten přesměrová všechny požadavky na
                    <filename>public/index.php</filename>, který nám také vytvořil
                    <code>Zend_Tool</code>.</para>
            <para>Soubor <filename>index.php</filename> tvoří vstupní bod do naší aplikace a jeho
                úkolem je inicializace aplikace vytvořením instance <code>Zend_Application</code> a
                nastavení konstant <code>APPLICATION_PATH</code> a <code>APPLICATION_ENV</code>,
                který definují cestu do adresáře <filename>application/</filename> a prostředí
                (neboli mód) aplikace. Výchozím prostředím je <code>production</code> a je vhodné ho
                změnit na <code>development</code> přidání řádku do souboru
                    <filename>.htaccess</filename>:</para>
            <programlisting language="php">SetEnv APPLICATION_ENV development</programlisting>
            <para>Komponenta <code>Zend_Application</code> je použita ke spuštění aplikace a je
                nastavena pomocí konfiguračního souboru
                    <filename>application/configs/application.ini</filename>, který nám byl také
                předgenerován. Bootstrapovací třída, která dědí od <code>
                    Zend_Application_Bootstrap_Bootstrap</code> je k dispozici v
                    <filename>application/Bootstrap.php</filename> a může být použita pro specifický
                kód inicializující naši aplikaci.</para>
            <para>Soubor <filename>application.ini</filename>, který je uložen v adresáři
                    <filename>application/configs</filename> je načítán pomocí
                    <code>Zend_Config_Ini</code>. Ten umí interpretovat dědičnost sekcí, kterou
                uvedeme pomocí dvojtečky. Například: </para>
            <programlisting language="ini">[staging : production]</programlisting>
            <para>To znamená, že sekce <code>staging</code> dědí nastavení sekce
                    <code>production</code>. Konstanta <code>APPLICATION_ENV</code> určuje, která
                sekce se načte. Při vývoji chceme používat sekci <code>development</code> a na živém
                serveru <code>production</code>. Všechny změny v <code>application.ini</code> budeme
                vkládat do sekce <code>production</code>. Tím docílíme toho,že všechny varianty
                konfigurace budou obsahovat to, co jsme přidali.</para>
        </section>
        <section>
            <title>Úpravy souboru application.ini</title>
            <para>První změna kterou musíme udělat je nastavení naší časové zóny, aby správně
                fungovaly PHPčkové funkce pro práci s datem a časem. Upravíme
                    <filename>application/configs/application.ini</filename> a přidáme:</para>
            <programlisting language="ini">phpSettings.date.timezone = "Europe/Prague"</programlisting>
            <para>pod všechny hodnoty <code>phpSettings</code> v sekci <code>[production]</code>.
                Samozřejmě volbu můžeme upravit podle své časové zóny. Teď už jsme připraveni začít
                přidávat kód specifický pro naši aplikaci.</para>
        </section>
    </section>
    <section>
        <title>Kód naší aplikace</title>
        <para>Předtím než začneme nastavovat naše soubory, je nutné pochopit, jak je aplikace v Zend
            Frameworku strukturovaná. Každá stránka aplikace je označována jako <emphasis
                role="bold">akce</emphasis> [en: action] a ty jsou seskupeny v <emphasis role="bold"
                >kontrolerech</emphasis> [en: controller]. Pro URL ve formátu
                <uri>http://localhost/public/zf-tutorial/news/view</uri> je kontroler
                <code>News</code> a akce <code>view</code>. To umožňuje seskupování souvisejících
            akcí. Například kontroler <code>News</code> může mít akce <code>list</code>,
                <code>archived</code>, <code>view</code>. MVC systém Zend Frameworku podporuje také
            moduly, které slouží k seskupování kontrolerů. Tato aplikace nebude tak veliká, abychom
            se s nimi museli zabývat.</para>
    </section>
</article>
